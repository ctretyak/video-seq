var u=Object.defineProperty;var g=(r,e,t)=>e in r?u(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>g(r,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";import{V as w}from"./video-tree-C_pDbh0c.js";class a{constructor(e,t,i=[]){s(this,"id");s(this,"src");s(this,"nodes");s(this,"video");this.id=e,this.src=t,this.nodes=i}static fromJSON(e,t=0){var i;return new a(t,e.src,(i=e.nodes)==null?void 0:i.map((o,n)=>a.fromJSON(o,n)))}async load(){this.video=document.createElement("video"),this.video.playsInline=!0,this.video.preload="auto",this.video.controls=!1,this.video.muted=!0,this.video.src=this.src;const e=new Promise(o=>{const n=()=>{this.video.removeEventListener("canplay",n);const d=()=>{this.video.removeEventListener("canplaythrough",d),o(this.video)};this.video.addEventListener("canplaythrough",d)};this.video.addEventListener("canplay",n)}),[t,i=[]]=await Promise.all([e,...this.nodes.map(o=>o.load())]);return[t,...i]}getNextVideoTree(){const e=this.nodes.length;if(e)return this.nodes[Math.floor(Math.random()*e)]}play(){this.video.play()}}class E{constructor(e,t,i){s(this,"tree");s(this,"canvas");s(this,"hiddenPlayersElem");s(this,"currentVideoTree");this.tree=e,this.canvas=t,this.hiddenPlayersElem=i,window.addEventListener("resize",o,!1);function o(){t.width=window.innerWidth,t.height=window.innerHeight}o()}async play(){const e=await this.tree.load(),t=document.getElementById("hidden-players");e.forEach(i=>{t==null||t.appendChild(i)}),this.playNextVideo()}playNextVideo(){var n;const e=((n=this.currentVideoTree)==null?void 0:n.getNextVideoTree())??this.tree;e.play();const t=this.canvas.getContext("2d"),i=()=>{const d=e.video,{width:p,height:y}=this.canvas.getBoundingClientRect();let h=100,c=100;if(d.videoWidth&&d.videoHeight){const l=Math.min(p/d.videoWidth,y/d.videoHeight);h=d.videoWidth*l,c=d.videoHeight*l}t==null||t.drawImage(e.video,0,0,h,c),e.video.requestVideoFrameCallback(i)};e.video.requestVideoFrameCallback(i);const o=()=>{e.video.removeEventListener("ended",o),this.playNextVideo()};e.video.addEventListener("ended",o),this.currentVideoTree=e}}let m=w;const V=new URLSearchParams(window.location.search),v=V.get("tree");v&&(m=JSON.parse(v));const f=a.fromJSON(m),L=new E(f,document.getElementById("canvas"),document.getElementById("hidden-players"));(async()=>L.play())();
