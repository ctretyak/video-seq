var N=Object.defineProperty;var O=(r,t,e)=>t in r?N(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var l=(r,t,e)=>O(r,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";import{f as p,V as E,S as f,C as b,A as U,T,e as B}from"./index-CU2cXWwI.js";import{V as F}from"./video-tree-C9LeQqEj.js";import{N as c,G as g}from"./NineSliceGeometry-CZfHVfUI.js";const H=class k extends E{constructor(t){var y,V,_,v;t instanceof p&&(t={texture:t});const{width:e,height:i,leftWidth:s,rightWidth:d,topHeight:n,bottomHeight:S,texture:o,roundPixels:u,...m}=t;super({label:"NineSliceSprite",...m}),this.renderPipeId="nineSliceSprite",this.batched=!0,this._didSpriteUpdate=!0,this._leftWidth=s??((y=o==null?void 0:o.defaultBorders)==null?void 0:y.left)??c.defaultOptions.leftWidth,this._topHeight=n??((V=o==null?void 0:o.defaultBorders)==null?void 0:V.top)??c.defaultOptions.topHeight,this._rightWidth=d??((_=o==null?void 0:o.defaultBorders)==null?void 0:_.right)??c.defaultOptions.rightWidth,this._bottomHeight=S??((v=o==null?void 0:o.defaultBorders)==null?void 0:v.bottom)??c.defaultOptions.bottomHeight,this.bounds.maxX=this._width=e??o.width??c.defaultOptions.width,this.bounds.maxY=this._height=i??o.height??c.defaultOptions.height,this.allowChildren=!1,this.texture=o??k.defaultOptions.texture,this.roundPixels=u??!1}get bounds(){return this._bounds}get width(){return this._width}set width(t){this.bounds.maxX=this._width=t,this.onViewUpdate()}get height(){return this._height}set height(t){this.bounds.maxY=this._height=t,this.onViewUpdate()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this.onViewUpdate()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this.onViewUpdate()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this.onViewUpdate()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this.onViewUpdate()}get texture(){return this._texture}set texture(t){t||(t=p.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get originalWidth(){return this._texture.width}get originalHeight(){return this._texture.height}onViewUpdate(){if(this._didViewChangeTick++,this._didSpriteUpdate=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}addBounds(t){const e=this.bounds;t.addFrame(e.minX,e.minY,e.maxX,e.maxY)}destroy(t){if(super.destroy(t),typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(i)}this._texture=null}};H.defaultOptions={texture:p.EMPTY};let x=H;function W(r){return typeof r=="string"?f.from(r):r}var I=Object.defineProperty,R=(r,t,e)=>t in r?I(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,a=(r,t,e)=>(R(r,typeof t!="symbol"?t+"":t,e),e);class L extends b{constructor(t){super(),a(this,"bg"),a(this,"fill"),a(this,"fillMask"),a(this,"progressStart",0),a(this,"_progress",0),a(this,"options"),a(this,"innerView"),a(this,"_view"),this.options=t,this.innerView=new b,this.addChild(this.innerView),t!=null&&t.bg&&(t!=null&&t.fill)&&this.init(t)}init({bg:t,fill:e,fillPaddings:i,progress:s}){this.setBackground(t),this.setFill(e,i),this.progress=s}setBackground(t){var e;this.bg&&this.bg.destroy(),(e=this.options)!=null&&e.nineSliceSprite&&(typeof t=="string"?this.bg=new x({texture:p.from(t),leftWidth:this.options.nineSliceSprite.bg[0],topHeight:this.options.nineSliceSprite.bg[1],rightWidth:this.options.nineSliceSprite.bg[2],bottomHeight:this.options.nineSliceSprite.bg[3]}):console.warn("NineSliceSprite can not be used with views set as Container.")),t instanceof g&&(this.bg=t),!this.bg&&(typeof t=="string"||t instanceof f)&&(this.bg=W(t)),this.innerView.addChildAt(this.bg,0)}setFill(t,e){var m;if(this.fill&&this.fill.destroy(),this.bg instanceof f&&t===this.bg){console.warn("Can not use same Sprite instance for bg and fill.");return}(m=this.options)!=null&&m.nineSliceSprite&&(typeof t=="string"?this.fill=new x({texture:p.from(t),leftWidth:this.options.nineSliceSprite.fill[0],topHeight:this.options.nineSliceSprite.fill[1],rightWidth:this.options.nineSliceSprite.fill[2],bottomHeight:this.options.nineSliceSprite.fill[3]}):console.warn("NineSliceSprite can not be used with views set as Container.")),this.fill||(t instanceof g?this.fill=t:this.fill=W(t)),this.innerView.addChildAt(this.fill,1);const i=(e==null?void 0:e.left)??0,s=(e==null?void 0:e.top)??0;this.fill.x=i,this.fill.y=s,this.fillMask&&(this.fill.mask=null,this.fillMask.destroy());const d=this.fill.width/2,n=this.fill.width/2,S=this.fill.height/2,o=this.fill.height/2;let u=p.WHITE;this.fill instanceof f&&this.fill.texture&&(u=this.fill.texture),this.fillMask=new x({texture:u,leftWidth:d,topHeight:S,rightWidth:n,bottomHeight:o}),this.fillMask.position.copyFrom(this.fill),this.addChild(this.fillMask),this.fill.mask=this.fillMask}validate(t){return t=Math.round(t),t<0?0:t>100?100:t}set progress(t){this._progress=this.validate(t),this.fill&&this.fillMask&&(this.fill.mask=null,this.fillMask.width=this.fill.width/100*(this._progress-this.progressStart),this.fillMask.x=this.progressStart/100*this.fill.width+this.fill.x,this.fillMask.height=this.fill.height,this.fill.mask=this.fillMask)}get progress(){return this._progress}set width(t){var e,i,s;if((e=this.options)!=null&&e.nineSliceSprite){if(this.bg&&(this.bg.width=t),this.fill){const d=((i=this.options.fillPaddings)==null?void 0:i.left)??0,n=((s=this.options.fillPaddings)==null?void 0:s.right)??0;this.fill.width=t-d-n,this.fillMask.width=t-d-n}this.progress=this._progress}else super.width=t}get width(){return super.width}set height(t){var e,i,s;if((e=this.options)!=null&&e.nineSliceSprite){if(this.bg&&(this.bg.height=t),this.fill){const d=((i=this.options.fillPaddings)==null?void 0:i.top)??0,n=((s=this.options.fillPaddings)==null?void 0:s.bottom)??0;this.fill.height=t-d-n,this.fillMask.height=t-d-n}this.progress=this._progress}else super.height=t}get height(){return super.height}}const h={fillColor:"#00b1dd",borderColor:"#FFFFFF",backgroundColor:"#fe6048",value:50,width:450,height:8,radius:25,border:1,animate:!0,vertical:!1},A=new g().roundRect(0,0,h.width,h.height,h.radius).fill(h.borderColor).roundRect(h.border,h.border,h.width-h.border*2,h.height-h.border*2,h.radius).fill(h.backgroundColor),G=new g().roundRect(0,0,h.width,h.height,h.radius).fill(h.borderColor).roundRect(h.border,h.border,h.width-h.border*2,h.height-h.border*2,h.radius).fill(h.fillColor);class Y extends L{constructor(){super({bg:A,fill:G})}}class w{constructor(t,e,i=[],s){l(this,"id");l(this,"sprite");l(this,"src");l(this,"nodes");l(this,"eventsText");this.id=t,this.src=e,this.nodes=i,this.eventsText=s}static fromJSON(t,e=0,i){var s;return new w(e,t.src,(s=t.nodes)==null?void 0:s.map((d,n)=>w.fromJSON(d,n,i)),i)}async loadSprites(){var i;console.info("loading sprite"+this.src);const[t]=await Promise.all([U.load({src:this.src}),...this.nodes.map(s=>s.loadSprites())]);console.info("loading sprite end"+this.src),this.sprite=new f(t),this.eventsText&&this.addEvents();const e=this.getVideo();(i=document.getElementById("hidden-area"))==null||i.appendChild(e),e.controls=!0,e.muted=!0,await this.resetVideo()}addEvents(){["audioprocess","canplay","canplaythrough","complete","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"].map(t=>{const e=this.getVideo();e.addEventListener(t,()=>{if(this.eventsText){const i=JSON.parse(this.eventsText.text);i[e.currentSrc.replace(/(\.mp4)+$/gm,"").slice(-8)]=t,this.eventsText.text=JSON.stringify(i,null,2)}})})}getVideo(){return this.sprite.texture.source.resource}async resetVideo(){return new Promise(t=>{const e=this.getVideo();e.pause();const i=()=>{e.removeEventListener("seeked",i),e.pause(),t()};e.addEventListener("seeked",i),e.currentTime=0})}play(){this.getVideo().play()}isEnded(){return this.getVideo().ended}getNextVideo(){const t=this.nodes.length;if(t)return this.nodes[Math.floor(Math.random()*t)]}getProgress(){const t=this.getVideo();return t.currentTime/t.duration*100}iOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}}class J extends b{constructor(e,i=!1){super();l(this,"tree");l(this,"currentVideo");l(this,"text");l(this,"progress");l(this,"playerWrapper");l(this,"playing",!1);this.text=new T({text:"Loading",style:{fill:"#fff"}}),this.addChild(this.text);let s;i&&(s=new T({text:"{}",style:{fill:"#fff"}}),s.x=450,s.zIndex=99,this.addChild(s)),this.progress=new Y,this.progress.y=this.text.height,this.addChild(this.progress),this.playerWrapper=i?document.getElementById("player-wrapper"):void 0,this.tree=w.fromJSON(e,0,s)}async play(){console.info("LOADING SPRITES: start"),await this.tree.loadSprites(),console.info("LOADING SPRITES: end"),this.playNextVideo(),this.playing=!0}playNextVideo(){var i;let e=(i=this.currentVideo)==null?void 0:i.getNextVideo();if(e?this.text.text+=` - ${e.id}`:(e=this.tree,this.text.text=`Video #${e.id}`),e.sprite.y=this.text.height+this.progress.height+8,this.addChild(e.sprite),this.currentVideo&&(this.removeChild(this.currentVideo.sprite),this.currentVideo.resetVideo()),this.playerWrapper){const s=e.getVideo();s.style.maxWidth="100%",s.style.maxHeight="100%",this.playerWrapper.innerHTML="",this.playerWrapper.appendChild(s)}e.play(),this.currentVideo=e}onTick(e){var i;if(this.playing&&((i=this.currentVideo)!=null&&i.isEnded()&&this.playNextVideo(),this.currentVideo)){this.progress.progress=this.currentVideo.getProgress();const s=this.currentVideo.getVideo(),d=e.screen.height-this.progress.height-this.text.height-8;if(s.videoWidth&&s.videoHeight){const n=Math.min(e.screen.width/s.videoWidth,d/s.videoHeight);this.currentVideo.sprite.width=s.videoWidth*n,this.currentVideo.sprite.height=s.videoHeight*n}}}}let P=F;const M=new URLSearchParams(window.location.search),C=M.get("tree");C&&(P=JSON.parse(C));(async()=>{const r=new B;await r.init({resizeTo:window}),document.body.appendChild(r.canvas);const t=new g().roundRect(0,0,100,100,10).fill(16777215,.5).beginPath().moveTo(36,30).lineTo(36,70).lineTo(70,50).closePath().fill(16777215);t.eventMode="static",t.cursor="pointer",r.stage.addChild(t);const e=new J(P,M.has("debug"));t.on("pointertap",()=>{t.destroy(),r.stage.addChild(e),e.play()}),r.ticker.add(()=>{t.destroyed||(t.x=(r.screen.width-t.width)/2,t.y=(r.screen.height-t.height)/2),e.onTick(r)})})();
